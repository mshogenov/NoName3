<Window
    x:Class="Marking.Views.MarkingView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:viewModel="clr-namespace:Marking.ViewModels"
    mc:Ignorable="d"
    xmlns:convertes="clr-namespace:Marking.Views.Converters" xmlns:convertes1="clr-namespace:Marking.Views.Converters"
    d:DataContext="{d:DesignInstance viewModel:MarkingVM}"
    FontSize="14"
    WindowStartupLocation="Manual"
    Title="Поставить отметку высоты"
    SizeToContent="Height"
    Width="450">
   <Window.Resources>
       <Style x:Key="ModernButton" TargetType="Button">
           <Setter Property="Background" Value="{StaticResource AccentColor}"/>
           <Setter Property="Foreground" Value="White"/>
           <Setter Property="FontSize" Value="14"/>
           <Setter Property="Height" Value="36"/>
           <Setter Property="BorderThickness" Value="0"/>
           <Setter Property="Template">
               <Setter.Value>
                   <ControlTemplate TargetType="Button">
                       <Border Background="{TemplateBinding Background}"
                               CornerRadius="6"
                               BorderThickness="{TemplateBinding BorderThickness}">
                           <ContentPresenter HorizontalAlignment="Center" 
                                             VerticalAlignment="Center"/>
                       </Border>
                       <ControlTemplate.Triggers>
                           <Trigger Property="IsMouseOver" Value="True">
                               <Setter Property="Background" Value="#2B6CB0"/>
                           </Trigger>
                           <Trigger Property="IsPressed" Value="True">
                               <Setter Property="Background" Value="#2C5282"/>
                           </Trigger>
                           <Trigger Property="IsEnabled" Value="False">
                               <Setter Property="Background" Value="#CBD5E0"/>
                           </Trigger>
                       </ControlTemplate.Triggers>
                   </ControlTemplate>
               </Setter.Value>
           </Setter>
       </Style>
       <convertes:BoolVisibilityConverter x:Key="BoolVisibilityConverter" />

    <!-- Базовые цвета -->
    <SolidColorBrush x:Key="PrimaryBackground" Color="#FFFFFF"/>
    <SolidColorBrush x:Key="SecondaryBackground" Color="#F7FAFC"/>
    <SolidColorBrush x:Key="PrimaryText" Color="#2D3748"/>
    <SolidColorBrush x:Key="AccentColor" Color="#3184CE"/>
    <SolidColorBrush x:Key="BorderColor" Color="#E2E8F0"/>
</Window.Resources>

<Grid Background="{StaticResource SecondaryBackground}">
    <Grid.RowDefinitions>
        <RowDefinition Height="2*" />
        <RowDefinition Height="Auto" />
        <RowDefinition Height="Auto" />
        <RowDefinition Height="auto" />
    </Grid.RowDefinitions>

    <!-- Основная панель выбора -->
    <Border Grid.Row="0" 
            Background="{StaticResource PrimaryBackground}"
            Margin="15,15,15,10"
            CornerRadius="8"
            BorderThickness="1"
            BorderBrush="{StaticResource BorderColor}">
        <StackPanel Margin="10">
            <TextBlock Text="Выберите марку:" 
                     FontSize="16" 
                     FontWeight="SemiBold"
                     Foreground="{StaticResource PrimaryText}"
                     Margin="5,5,5,10" />

            <ListBox ItemsSource="{Binding Path=Marks}"
                    SelectedItem="{Binding Path=SelectedItem, Mode=TwoWay}"
                    BorderThickness="0"
                    Background="Transparent">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding Name}" 
                                 Padding="8,6"/>
                    </DataTemplate>
                </ListBox.ItemTemplate>
                <ListBox.ItemContainerStyle>
                    <Style TargetType="ListBoxItem">
                        <Setter Property="Margin" Value="2"/>
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="ListBoxItem">
                                    <Border x:Name="Bd"
                                            Background="{TemplateBinding Background}"
                                            CornerRadius="4"
                                            BorderThickness="1"
                                            BorderBrush="Transparent">
                                        <ContentPresenter/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter Property="Background" Value="PowderBlue"/>
                                            <Setter Property="BorderBrush" Value="{StaticResource AccentColor}"/>
                                        </Trigger>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="PowderBlue"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </ListBox.ItemContainerStyle>
            </ListBox>
        </StackPanel>
    </Border>

    <!-- Чекбокс -->
    <CheckBox Grid.Row="1" 
              Content="Записывать этаж" 
              IsChecked="{Binding Path=IsChecked}"
              Margin="20,5"
              HorizontalContentAlignment="Center"
              FontSize="14"
              VerticalContentAlignment="Center">
        <CheckBox.Style>
            <Style TargetType="CheckBox">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="CheckBox">
                            <Grid>
                                <Border x:Name="Border" 
                                        Width="18" Height="18" 
                                        BorderThickness="2"
                                        BorderBrush="#CBD5E0"
                                        CornerRadius="4"
                                        Background="White"
                                        HorizontalAlignment="Left">
                                    <Path x:Name="Checkmark" 
                                          Stroke="{StaticResource AccentColor}"
                                          StrokeThickness="2"
                                          Data="M4,8 L7,11 L14,4"
                                          Visibility="Collapsed"/>
                                </Border>
                                <ContentPresenter Margin="28,0,0,0" 
                                                VerticalAlignment="Center"/>
                            </Grid>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsChecked" Value="True">
                                    <Setter TargetName="Checkmark" Property="Visibility" Value="Visible"/>
                                    <Setter TargetName="Border" Property="BorderBrush" Value="{StaticResource AccentColor}"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </CheckBox.Style>
    </CheckBox>

    <!-- Кнопки действий -->
    <Grid Grid.Row="2" Margin="15,5,15,15">
        <Grid.ColumnDefinitions>
            <ColumnDefinition />
            <ColumnDefinition />
        </Grid.ColumnDefinitions>

        <Button Content="Обновить марки" 
                Grid.Column="0" 
                Margin="5" 
                Command="{Binding UpdateMarksCommand}"/>

        <Button Content="Поставить марки" 
                Grid.Column="1" 
                Margin="5"
                Command="{Binding PlaceStampsCommand}"
                CommandParameter="{Binding RelativeSource={RelativeSource AncestorType={x:Type Window}}}"/>
        
    </Grid>

    <!-- Панель предупреждения -->
    <Border Grid.Row="3"
            Visibility="{Binding OutstandingFamilyVisibility, Converter={StaticResource BoolVisibilityConverter}}"
            Background="#FFF5F5"
            BorderBrush="#FED7D7"
            BorderThickness="1"
            CornerRadius="6"
            Margin="15,0,15,15"
            Padding="15">
        <StackPanel>
            <TextBlock TextWrapping="Wrap" 
                      Foreground="#C53030"
                      Margin="0,0,0,10">
                В проекте отсутствует целевое семейство.<LineBreak/>
                Добавить семейство в проект?
            </TextBlock>

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition />
                    <ColumnDefinition />
                </Grid.ColumnDefinitions>

                <Button Grid.Column="0" 
                        Content="Да"
                        Margin="0,0,5,0"
                        Command="{Binding DownloadFamilyCommand}"/>

                <Button Grid.Column="1" 
                        Content="Нет"
                        Margin="5,0,0,0"/>
            </Grid>
        </StackPanel>
    </Border>
</Grid>
</Window>