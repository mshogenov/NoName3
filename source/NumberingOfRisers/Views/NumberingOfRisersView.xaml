<views:BaseRevitWindow x:Class="NumberingOfRisers.Views.NumberingOfRisersView"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                 xmlns:local="clr-namespace:NumberingOfRisers.Views"
                 xmlns:models="clr-namespace:NumberingOfRisers.Models"
                 xmlns:converters="clr-namespace:NumberingOfRisers.Views.Converters"
                 xmlns:vm="clr-namespace:NumberingOfRisers.ViewModels"
                 xmlns:views="clr-namespace:NoNameApi.Views;assembly=NoNameAPI"
                 mc:Ignorable="d"
                 d:DataContext="{d:DesignInstance vm:NumberingOfRisersViewModel }"
                 Title="Window1" Height="450" Width="800">
    <Window.Resources>
        <converters:BoolVisibilityConverter x:Key="BoolVisibilityConverter" />
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="2*" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
<StackPanel Orientation="Horizontal"
            >
    <Button Content="Добавить стояк"
            Command="{Binding AddRiserCommand}" />
    <Button Grid.Row="2"
            Content="Обновить данные"/>
</StackPanel>
        <!-- Основной контент -->
       
        <TreeView
            Grid.Row="1"
            ItemsSource="{Binding RiserSystemTypes}"
            Margin="10"
            Height="300"
            MaxHeight="300"
            ScrollViewer.VerticalScrollBarVisibility="Auto">
            <TreeView.ItemTemplate>
                <HierarchicalDataTemplate DataType="{x:Type models:RiserSystemType}"
                                          ItemsSource="{Binding Risers, UpdateSourceTrigger=PropertyChanged}">
                    <StackPanel Orientation="Horizontal">
                        <CheckBox IsChecked="{Binding IsChecked}" />
                        <TextBlock Text="{Binding MepSystemTypeName}" />
                        <TextBlock Text=" (" />
                        <TextBlock Text="{Binding Risers.Count, UpdateSourceTrigger=PropertyChanged}" />
                        <TextBlock Text=" стояков)" />
                        <Button Content="Выделить все"
                                Command="{Binding  DataContext.HighlightAllCommand, RelativeSource={RelativeSource AncestorType=Window}}" />
                    </StackPanel>

                    <HierarchicalDataTemplate.ItemTemplate>
                        <DataTemplate DataType="{x:Type models:Riser}">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Стояк №" />
                                <TextBlock Text="{Binding Number, UpdateSourceTrigger=PropertyChanged}" />
                                <TextBlock Text=" (" />
                                <TextBlock Text="{Binding CountPipes}" />
                                <TextBlock Text=" труб)" />
                                <TextBox Width="50"
                                         Text="{Binding  Path=NewNumberRiser,UpdateSourceTrigger=PropertyChanged }" />
                                <Button Content="Нумеровать"
                                        Command="{Binding DataContext.NumberSelectedRiserCommand,RelativeSource={RelativeSource AncestorType=Window} }"
                                        CommandParameter="{Binding}" />
                                <Button Content="Выделить"
                                        Command="{Binding  DataContext.HighlightRiserCommand,RelativeSource={RelativeSource AncestorType=Window} }"
                                        CommandParameter="{Binding}" />
                                <Button Content="Удалить"
                                        CommandParameter="{Binding}"
                                        Command="{Binding  DataContext.DeleteRiserCommand, RelativeSource={RelativeSource AncestorType=Window}}" />
                            </StackPanel>
                        </DataTemplate>
                    </HierarchicalDataTemplate.ItemTemplate>
                </HierarchicalDataTemplate>
            </TreeView.ItemTemplate>
        </TreeView>

        <Grid Grid.Row="3">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <!-- Выбор направления нумерации -->
            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                <TextBlock Text="Направление нумерации:" VerticalAlignment="Center" Margin="0,0,10,0" />
                <ComboBox Width="250"
                          ItemsSource="{Binding NumberingStrategies}"
                          SelectedItem="{Binding SelectedStrategy}"
                          DisplayMemberPath="DisplayName" />
            </StackPanel>
            <Button Grid.Row="1"
                    Content="Нумеровать стояки"
                    Command="{Binding Path=NumberingOfRisersCommand}" />
            <Button
                Grid.Row="2" Content="Сохранить данные" 
                    Command="{Binding SaveRisersDataCommand}"/>
        </Grid>
       
        <StackPanel Grid.Row="4" Orientation="Horizontal"
                    Visibility="{Binding Path= IsVisibilityMissingParameters,Converter={StaticResource BoolVisibilityConverter}}" >
           
            <Button Content="Добавить параметр" 
                    Command="{Binding AddParameterCommand}"/>
          
        </StackPanel>
    </Grid>
</views:BaseRevitWindow>
